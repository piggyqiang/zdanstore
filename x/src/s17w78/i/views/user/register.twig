{% extends "layouts/base.twig" %}
{% set title_name = "用户注册" %}
{% block header %}
{% include "layouts/header.twig" %}
{% endblock %}
{% block content %}
<div class="login_main mbg">
    <div class="reg_box clearfix">
    	{% include "layouts/notify.twig" %}
        <div class="reg_pic"><img src="{{ App.assets.Url }}/images/user/reg_pic.png"/></div>
        <div class="reg_txt">
            已有1378玩家账号？<br/><a href="/user/login"><img src="{{ App.assets.Url }}/images/user/reg_link.png"/></a>
        </div>
        <div class="reg_form">
            <h3>用户注册</h3>
            {% set form = this.beginWidget("bootstrap.widgets.TbActiveForm", {'type':'horizontal','id':'create-form','enableAjaxValidation':true,'htmlOptions':{'class':'form-horizontal','enctype':'multipart/form-data'} }) %}
            <ul>
                <li class="clearfix">
                    <span><em class="red">*</em> 用户名：</span>
                    {{ form.textField(user, "username", {'placeholder':'','class':"login_input"})|raw }}
                    {{ form.error(user, 'username', {'placeholder':'','class':"login_span"})|raw }}
                </li>
                <li class="clearfix">
                    <span><em class="red">*</em> 密码：</span>
                    {{ form.passwordField(user, "password", {'placeholder':'','class':"login_input",'onKeyUp':"pwStrength(this.value)",'onBlur':"pwStrength(this.value)"})|raw }}
                    <table width="120" bordercolor="#cccccc" height="23" style="float:left"> 
                        <tr bgcolor="#eeeeee"> 
                            <td width="40" id="strength_L" style="text-align:center;">弱</td> 
                            <td width="40" id="strength_M" style="text-align:center;">中</td> 
                            <td width="40" id="strength_H" style="text-align:center;">强</td> 
                        </tr> 
                    </table> 
                    {{ form.error(user, 'password', {'placeholder':'','class':"login_span"})|raw }}
                </li>
                <li class="clearfix">
                    <span><em class="red">*</em> 确认密码：</span>
                    {{ form.passwordField(user, "password_repeat", {'placeholder':'','class':"login_input"})|raw }}
                    {{ form.error(user, 'password_repeat', {'placeholder':'','class':"login_span"})|raw }}
                </li>
                <li class="clearfix">
                    <span><em class="red">*</em> 昵称：</span>
                    {{ form.textField(user, "nickname", {'placeholder':'','class':"login_input"})|raw }}
                    {{ form.error(user, 'nickname', {'placeholder':'','class':"login_span"})|raw }}
                   
                </li>
                <li class="clearfix">
                    <span><em class="red">*</em> 验证码：</span>
                    {{ form.textField(user, "verifyCode", {'placeholder':'','class':"login_input",'style':"width:60px;"})|raw }}
                    {{ void(this.widget('CCaptcha',{'showRefreshButton':false,'clickableImage':true,'imageOptions':{'alt':'点击换图','title':'点击换图','align':'absmiddle','style':'height:31px;cursor:pointer'}})) }}<div style="display:none">{{ this.createAction('captcha').getVerifyCode(true)}} </div>
                    {{ form.error(user, 'verifyCode', {'placeholder':'','class':"login_span"})|raw }}
                </li>
                <li class="clearfix">
                    <p><input type="checkbox" id="agreement" checked="checked"> 我已经看过并同意《<a class="blue" target="_blank" href="http://www.1378.com/protocal.html">账号使用协议</a>》 <em class="red" id="tip_agreement"></em><p>
                </li>
                <li class="clearfix">
                    <input type="button" onclick="loginSubmit();" value="立即注册" class="reg_btn"/>
                </li>
            </ul>
            {{ void(this.endWidget()) }}<!-- form -->
        </div>
    </div>
</div>
<script language=javascript> 
$(document).ready(function(){
    // check agreement
    $("#agreement").click(function(){
        if(!$(this).attr("checked")){
          $(this).parent().find("em").html('必须同意用户充值协议'); 
        }else{
          $(this).parent().find("em").html('');
        }
    });
});
function loginSubmit(){
    if($("#tip_agreement").html() ==""){
        $("#create-form").submit();
    }
}
function len(s){ //获取字符串的字节长度
  s=String(s);
    return s.length+(s.match(/[^\x00-\xff]/g) ||"").length;//加上匹配到的全角字符长度
}
function limitDo(obj,limit){
  var val=obj.value;
    if(len(val)>limit) {
        //val=val.substr(0,limit);
        while(len(val=val.substr(0,val.length-1))>limit);
        obj.value=val;
    }
}
document.getElementById("User_nickname").onkeyup=function(){limitDo(document.getElementById("User_nickname"),16)};
//CharMode函数 
//测试某个字符是属于哪一类. 
function CharMode(iN)
{ 
    if (iN>=48 && iN <=57) //数字 
        return 1; 
    if (iN>=65 && iN <=90) //大写字母 
        return 2; 
    if (iN>=97 && iN <=122) //小写 
        return 4; 
    else 
        return 8; //特殊字符 
} 

//bitTotal函数 
//计算出当前密码当中一共有多少种模式 
function bitTotal(num)
{ 
    modes=0; 
    for (i=0; i<4; i++)
    { 
        if (num & 1) modes++; 
        num>>>=1; 
    } 
    return modes; 
} 

//checkStrong函数 
//返回密码的强度级别 

function checkStrong(sPW)
{ 
    if (sPW.length<=4) 
        return 0; //密码太短 
    Modes=0; 
    for (i=0; i<sPW.length; i++)
    { 
        //测试每一个字符的类别并统计一共有多少种模式. 
        Modes|=CharMode(sPW.charCodeAt(i)); 
    } 
    return bitTotal(Modes); 
} 

//pwStrength函数.www.qichepeijian.com 
//当用户放开键盘或密码输入框失去焦点时,根据不同的级别显示不同的颜色 

function pwStrength(pwd)
{ 
    O_color="#eeeeee"; 
    L_color="#FF0000"; 
    M_color="#FF9900"; 
    H_color="#33CC00"; 
    if (pwd==null||pwd=='')
    { 
        Lcolor=Mcolor=Hcolor=O_color; 
    } 
    else
    { 
        S_level = checkStrong(pwd); 
        switch(S_level) 
        { 
            case 0: 
                Lcolor = Mcolor = Hcolor = O_color; 
            case 1: 
                Lcolor = L_color; 
                Mcolor = Hcolor = O_color; 
                break; 
            case 2: 
                Lcolor = Mcolor = M_color; 
                Hcolor = O_color; 
                break; 
            default: 
                Lcolor=Mcolor=Hcolor=H_color; 
        } 
    } 

    document.getElementById("strength_L").style.background=Lcolor; 
    document.getElementById("strength_M").style.background=Mcolor; 
    document.getElementById("strength_H").style.background=Hcolor; 
    return; 
} 

</script> 
{% endblock %}
