{% extends "base/main.twig" %}
{% block content %}
<div class="main">
    <div class="position"><a href="#">Home</a> &gt; <a href="#">View Cart</a></div>
    <div class="cart_list">
            <form action="/shopping/checkaddr" method="post" class="cart_from">
        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="cart_table">
            <thead>
            <tr>
                <td width="320">Product</td>
                <td width="116">Price</td>
                <td width="116">Quantity</td>
                <td>Edit Item</td>
            </tr>
            </thead>
            <tbody>
        	{% for kid,cart in carts %}
            <tr>
                <td>
                    <div class="cart_p clearfix">
                        <div class="pic">
                            <a href="{{ this.createUrl('/product/view',{'id':cart.id }) }}" title=""><img src="{{ cart.logo }}" width="68" height="78" /></a>
                        </div>
                        <p class="txt">
                            <b><a href="{{ this.createUrl('/brands/view',{'id':cart.brand_id }) }}" target="_blank" title="">{{ cart.brand_name }}</a></b><br/>
                            <a href="{{ this.createUrl('/product/view',{'id':cart.id }) }}" title="">{{ cart.productName }}</a><br/>
                            <i>{{ cart.batch_number  }}</i><br>
                            {% for k,v in cart.profiles %}
                            	{{ k }}: {{ v }}<span>|</span>
                            {% endfor %}
                        </p>
                    </div>
                </td>
                <td class="price"><b>${{ cart.shop_price }}</b></td>
                <td>
                    <div class="buy_input">
                        <a href="#" class="reduce">-</a>
                        <input value="{{ cart.quantity }}" name="Product[{{ kid }}][quantity]" class="buy_num" class="text" readOnly="true">
                        <a href="#" class="add">+</a>
                        <input type="hidden" class="shop_price" value="{{ cart.shop_price }}" />
                    </div>
                </td>
                <td>
                    <input type="hidden" name="" value="{{ cart.cart_id }}" />
                    <a href="javascript:void(0);" class="delete"><i>Remove</i></a><br>
                    <a href="#"><i>Add to Wish List</i></a>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="cart_total">
            <span>Sub  Total:</span>$<em id="total_price">{{ total }}</em>
        </div>
        <div class="cart_link clearfix">
            <a href="#" class="link1 fl">Continue Shopping</a>
            <a href="javascript:void(0);" onclick="$('.cart_from').submit();" class="link1 fr"><img src="images/cart_ico.png" align="absmiddle" />Checkout</a>
        </div>
    </form>
    </div>

    <!-- ad2 -->
    <div class="ad2 clearfix">
        <div class="fl"><a href="#" title=""><img src="images/test/p4.jpg" width="482" height="120" /></a></div>
        <div class="fr"><a href="#" title=""><img src="images/test/p5.jpg" width="482" height="120" /></a></div>
    </div>

</div>
<script type="text/javascript">
$(".reduce").click(function(){
    var qut = parseInt($(this).parent().find(".buy_num").val());
    var price = parseInt($(this).parent().find(".shop_price").val());
    var total = parseInt($("#total_price").text());
    if(qut == 1){
        return false;
    }else{
        qut = qut -1;
        total = total - price;
        $("#total_price").text(total);
        $(this).parent().find(".buy_num").val(qut);
    }
});
$(".add").click(function(){
    var qut = parseInt($(this).parent().find(".buy_num").val());
    var price = parseInt($(this).parent().find(".shop_price").val());
    var total = parseInt($("#total_price").text());
    qut = qut + 1;
    total = total + price ;
    $("#total_price").text(total);
    $(this).parent().find(".buy_num").val(qut);
});

$(".delete").click(function(){
    var parentObj = $(this).parent().parent();
    var id = $(this).parent().find("input").val();
    var cartData = {"id":id};
    $.ajax({
        type: "POST",
        url:"/shopping/delete",
        data:cartData,
        dataType:'json',
        success:function(data){   
            $(parentObj).fadeOut(); 
        }
    });
});
</script>
{% endblock %}