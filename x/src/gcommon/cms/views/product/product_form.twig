<div class="form">
{% include "layouts/notice.twig" %}
{% set form = this.beginWidget("bootstrap.widgets.TbActiveForm", {'type':'horizontal','id':'create- form','enableAjaxValidation':false,'htmlOptions':{'class':'form-horizontal','enctype':'multipart/form-data'} }) %}
{{ form.textFieldRow(model, "name", {'placeholder':''})|raw }}
<div class="controls">
    <span>插入</span>      
        <img valign="top" alt="Image" title="Image" onClick="insertFileToContent('image');" src="{{ App.assets.Url}}/images/insert_image.png" />
</div>
{{ form.textAreaRow(model, "desc", {'placeholder':'','id':'ckeditor_content','class':'specialContent'})|raw }}
{{ form.dropDownListRow(model, 'status', model.Status, {})|raw }}
{{ form.dropDownListRow(model, 'brand_id', model.Brands, {})|raw }}
{{ form.textFieldRow(model, "rank", {'placeholder':''})|raw }}
{{ form.textFieldRow(model, "batch_number", {'placeholder':''})|raw }}
{{ form.textFieldRow(model, "quantity", {'placeholder':''})|raw }}
{{ form.textFieldRow(model, "total_price", {'placeholder':''})|raw }}
{{ form.textFieldRow(model, "shop_price", {'placeholder':''})|raw }}
{% if isNew == true %}
  <div  class="control-group">
      <label for="Category_name" class="control-label required">父类 <span class="required">*</span></label>
      <div class="controls">
         {% for desc in descendants %}
                      <input type="checkbox" name="Oterm[]" value="{{ desc .id }}">{{ str_repeat(desc.level ) }}{{ desc.name }}({{ desc.level-1 }}级分类 )<br />  
         {% endfor %}
      </div>
  </div>
{% else %}
  <div  class="control-group">
      <label for="Category_name" class="control-label required">父类 <span class="required">*</span></label>
      <div class="controls">
         {% for desc in descendants %}
                      <input type="checkbox" name="Oterm[]" value="{{ desc .id }}" {% if desc.id in select_terms %} checked {% endif %} >{{ str_repeat(desc.level ) }}{{ desc.name }}({{ desc.level-1 }}级分类 )<br />  
         {% endfor %}
      </div>
  </div>
{% endif %}
{% if isNew == true %}
  <div  class="control-group">
      <label for="Category_name" class="control-label required">商品属性</label>
        <div class="controls">
          <div id="uploads">
            <a class="btn btn-success" onclick="return showUpload();">add</a>
        </div>
      </div>
  </div>
{% else %}
  <div  class="control-group">
      <label for="Category_name" class="control-label required">商品属性</label>
        <div class="controls">
          <div id="uploads">
            <a class="btn btn-success" onclick="return showUpload();">add</a>
            {% for meta in metas %}
              <div id="pic_{{ loop.index }}" class="picCount"><a onclick="return deletePic('pic_{{ loop.index }}');" class="btn btn-danger">delete</a><br>
                名称:<input type="text" name="Meta[{{ loop.index }}][key]" value="{{ meta.meta_key }}"><br>值:<input type="text" name="Meta[{{ loop.index }}][value]" value="{{ meta.meta_value }}"><br></div>
            {% endfor %}
        </div>
      </div>
  </div>
{% endif %}
<div class="control-group">
  <div class="controls">
    <button type="submit" class="btn btn-large btn-primary">提交</button>
  </div>
</div>
{{ void(this.endWidget()) }}<!-- form -->
<script type="text/javascript">
    CKEDITOR.replace( 'ckeditor_content', {
        toolbar: 'Full'
    });

    var i=$(".picCount").length;
    function showUpload(){
      i++;
      var str='<div class="picCount" id="pic_'+i+'"><a class="btn btn-danger" onclick="return deletePic(\'pic_'+i+'\');">delete</a><br/>';
                str+='名称:'+i+'<input type="text" value="" name="Meta['+i+'][key]" /><br>';
                str+='值:<input type="text" value="" name="Meta['+i+'][value]" /><br>';
                str+='</div>';
      $("#uploads").append(str);
    }

    function deletePic(id){
        $("#"+id).html("");
    }

    $(document).ready(function(){
           $("a[rel^='prettyPhoto']").prettyPhoto({show_title: true,social_tools: '',deeplinking: false});
      });
    function insertFileToContent(file_type){                        
        $.prettyPhoto.open('/pp/resource/createframe?parent_call=true&ckeditor='+file_type+'&iframe=true&height=400','','');        
    }
    function afterUploadResourceWithGame(resource_path,image_id){
        $("#"+image_id).val(resource_path);
        $("."+image_id).attr("src",resource_path);
        $.prettyPhoto.close();
    }
    function afterUploadResourceWithEditor(resource_id,resource_path,file_type,insert_type,width,height,alt){
        var add_width='';
        var add_height='';
        var add_alt='';
        if(width!='0') add_width='width="'+width+'"';
        if(height!='0') add_height='height="'+height+'"';
        if(alt!='') add_alt='alt="'+alt+'"';   
        if(file_type=='image'){
            CKEDITOR.instances['ckeditor_content'].insertHtml('<img '+add_width+' '+add_height+' '+ add_alt+' src="'+resource_path+'"/>');  
        }
        if(file_type=='video'){
            /*
            if(width!='0') add_width="'width': '"+width+"',";
            if(height!='0') add_height="'height': '"+height+"',";
            
            var video_insert="<div id='mediaplayer"+media_count+"'></div>"+         
             '<script type="text/javascript" src="\'+player_path+\'/jwplayer.js"><'+'/script>'+'<script type="text/javascript">'+
              "jwplayer('mediaplayer"+media_count+"').setup({"+
                "'flashplayer': '\"+player_path+\"/player.swf',"+
                "'id': 'playerID"+media_count+"',"+
                add_width+
                add_height+
                "'file': '"+resource_path+"'"+
              '});'+'<'+'/script>';          
              CKEDITOR.instances['ckeditor_content'].insertHtml(video_insert);
              media_count++;    
              */        
        }
            
        
        $.prettyPhoto.close();
    }
</script>